app-id: io.github.rubiojr.whereami
runtime: org.kde.Platform
runtime-version: "6.9"
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
command: whereami
finish-args:
  # Graphics
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=dri

  # Network access for map tiles
  - --share=network

  # Access to location services
  - --system-talk-name=org.freedesktop.GeoClue2

  # Let the user save their bookmarks
  - --filesystem=xdg-documents/whereami:create

  # Theme access for proper window decorations
  - --filesystem=xdg-config/kdeglobals:ro
  - --filesystem=xdg-config/kwinrc:ro
  - --env=QT_QPA_PLATFORMTHEME=kde
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.freedesktop.portal.Desktop
  - --talk-name=org.freedesktop.portal.Settings

build-options:
  append-path: /usr/lib/sdk/golang/bin:/usr/lib/libexec
  env:
    GOPATH: /run/build/whereami/gopath

modules:
  - name: whereami
    buildsystem: simple
    build-commands:
      - mkdir -p vendor && cp modules.txt vendor/modules.txt
      - . /usr/lib/sdk/golang/enable.sh && cd vendor/github.com/mappu/miqt/cmd/miqt-rcc && go build -v -mod=vendor -o /app/bin/miqt-rcc .
      - . /usr/lib/sdk/golang/enable.sh && go generate
      - . /usr/lib/sdk/golang/enable.sh && go build -v -mod=vendor -ldflags '-s -w' -o whereami .
      - install -Dm755 whereami /app/bin/whereami
      - install -Dm644 desktop/io.github.rubiojr.whereami.desktop /app/share/applications/io.github.rubiojr.whereami.desktop
      - install -Dm644 ui/icons/hicolor/128x128/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/128x128/apps/io.github.rubiojr.whereami.png
      - install -Dm644 ui/icons/hicolor/256x256/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/256x256/apps/io.github.rubiojr.whereami.png
      - install -Dm644 ui/icons/hicolor/512x512/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/512x512/apps/io.github.rubiojr.whereami.png
      - install -Dm644 ui/icons/hicolor/16x16@2/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/16x16@2/apps/io.github.rubiojr.whereami.png
      - install -Dm644 ui/icons/hicolor/24x24@2/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/24x24@2/apps/io.github.rubiojr.whereami.png
      - install -Dm644 ui/icons/hicolor/32x32@2/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/32x32@2/apps/io.github.rubiojr.whereami.png
      - install -Dm644 ui/icons/hicolor/48x48@2/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/48x48@2/apps/io.github.rubiojr.whereami.png
      - install -Dm644 ui/icons/hicolor/64x64@2/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/64x64@2/apps/io.github.rubiojr.whereami.png
      - install -Dm644 ui/icons/hicolor/128x128@2/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/128x128@2/apps/io.github.rubiojr.whereami.png
      - install -Dm644 ui/icons/hicolor/256x256@2/apps/io.github.rubiojr.whereami.png /app/share/icons/hicolor/256x256@2/apps/io.github.rubiojr.whereami.png
    sources:
      - type: git
        url: https://github.com/rubiojr/whereami.git
        tag: v0.1.10
        commit: 0d08f4a3c4b6285f8b03635cd0693888287bc799
      - type: file
        path: modules.txt
      - go.mod.json
